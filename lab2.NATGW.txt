Лабораторная работа номер 2. Создание виртуальных машин и организация удаленного доступа к каждой через один внешний адрес.

# В рамках данной лабораторной работы необходимо будет создать две виртуальные машины с разными ОС на базе Windows и Linux (Ubuntu) и получить к ним
# удаленный доступ через общий внешний (белый) IP адрес (EIP). Для этого необходимо будет настроить NAT Gateway, который и поможет решить 
# поставленную задачу.

Задание 1. Создание виртуальных машин без EIP.

1) На примере шагов создания из лабораторной работы номер 1, необходимо создать две виртуальные машины.
2) Оставляем настройки по умолчанию.
3) В разделе Image, выставляем:
3.1) Public Image - Select OS - Windows - Windows Server 2019 ...
3.2) Public Image - Select OS - Ubuntu - Ubuntu 18.04 server ...
4) В разделе настроек Security Groups не забываем созданную нами раннее группу с настройками внешнего доступа. Проверяем, что там есть правило на
порт 3389 для Remote Desktrop Protocol (Windows)
5) В настройках EIP ОБЯЗАТЕЛЬНО выставляем опцию Do not use.
6) Создаем две разных машин

# По результатам шагов мы создали две виртуальные машины, готовые для того, чтобы к ним можно было продключиться по удаленному подключению, при 
# условии корректной конфигуарации со стороны облака.

Задание 2. Создание EIP.

1) Через Homepage переходим в раздел Network - Elastic IP
2) Нажимаем Assign IP
3) Bandwidth выставляем 5-10 Mbit
4) Bandwidth name: lab_eip_<username>
5) Далее нажимаем Create Now (зеленая кнопка)
6) На следующей страницы еще раз нажимаем Submit (зеленая кнопка)

# Таким образом мы создали EIЗ (белый адрес), который далее мы можем назначить как на ВМ, так и на любой другой вычислительный ресурс облака:
# база данных, контейнер, балансировщик нагрузки, ВПН или другое.

Задание 3. Создание и настройка NAT Gateway для подключения к нашим виртуальным машинам.

1) Через Homepage идем в Network - NAT Gateway
2) В углу нажимаем Create NAT Gateway (Зеленая кнопка)
3) Name: lab_nat_<username>
4) В VPC указываем используемую нами для лабораторной работы локальную сеть, в которую входят обе наших виртуальных машин
5) В Subnet также указываем подсеть, в которой ноходятся наши виртуальным машины (из задания 1)
6) Type: Small
7) Next -> Submit (зеленые кнопочки)

# На данном моменте мы создали NAT Gateway. Как процесс создания будет завершен он будет готов к дальнейшей настройке.

8) В списке наших шлюзов выбираем созданный нами.
9) Откроется таблица с пустыми правилами.
10) Начинаем настройку правил SNAT:
10.1) Add SNAT Rule
10.2) VPC - Subnet (тут выбрать подсеть с нашими ВМ)
10.3) EIP: выбрать созданный нами ранее белый IP адрес
10.4) Нажать OK
11) Будем присвоен внешний IP адрес нашему шлюзу. Сам шлюз будет связан с указанной нами подсетью.
# SNAT правило позволяет нам настроить внешнюю сторону шлюза, его белый IP адрес и его связь с внутренней подсетью облака.
12) Далее создать DNAT правило, Add DNAT Rule:
12.1) Scenario VPC
12.2) Specific Port
12.3) Protocol TCP
12.4) EIP (здесь уже будет стоять Ваш внешний IP адрес)
12.5) Здесь указать любой нравящийся Вам порт (3389 или 22 по умолчанию, но можете 44489, или что то еще)
12.6) Private IP Address: указать IP адрес одной из созданных нами ВМ. IP адрес должен соответствовать подсети облака, а не внешнему адресу.
12.7) Inside Port: указать внутренный порт ВМ или иного ресурса. Для нашей работы, 3389 для Windows, 22 для Linux.
13) После выполнения шагов один раз для первой ВМ, их повторить для второй ВМ (заменяя адрес и порт для соответствующей ВМ и ОС)
# DNAT правила настраивают именно уже внутреннюю таблиц проброса портов и адресов в облаке.

Задание 4. Проверка подключения.

1) Проверить, что фаерволлы внутри ОС отключены:
1.1) В Windows воспользоваться гуглом, чтобы узнать как проверить и отключить
1.2) В Linux - Ubuntu в терминале ввести: systemctl status ufw, отключить systemctl disable --now ufw. Также можно добавить правило на SSH: ufw allow 22/tcp
2) Произвести подключение к Windows машине:
2.1) Открыть RDP: <EIP>:<port> - и использовать параметры входа настроенные в облаке
3) Произвести подключение к Linux машине через Putty, Kitty, cmd/ssh или другое, что нравится:
3.1) <EIP>:<port>
3.2) Авторизоваться параметрами входа настроенными в облаке

# По результатам работы мы научили создавать NAT Gateway и использовать только один внешний адрес для нескольких ресурсов в облаке.

!! После выполнения всех шагов и удачного подключения к машинам:
1) Пройти тест, который приложен к статье Базе Знаний с описанием лабораторной работы
2) Удалить и отвязать все созданные ресурсы (2 ВМ, 1 белый адрес и шлюз NAT)

